// ==========================================================
// تواقيت الصلاة — رمضان 1447هـ / 2026م — المغرب
// المصدر: ma.prayertimes.news (منهج وزارة الأوقاف)
// فاتح رمضان: الخميس 19 فبراير 2026م
// كل صفوف المدن: من اليوم 2 في الجدول (19 فبراير = يوم 1 رمضاننا)
// [فجر، شروق، ظهر، عصر، مغرب، عشاء]
// ==========================================================

export const RAMADAN_DAYS = [
  { day: 1,  dateStr: '19/02/2026', dayName: 'الخميس' },
  { day: 2,  dateStr: '20/02/2026', dayName: 'الجمعة' },
  { day: 3,  dateStr: '21/02/2026', dayName: 'السبت' },
  { day: 4,  dateStr: '22/02/2026', dayName: 'الأحد' },
  { day: 5,  dateStr: '23/02/2026', dayName: 'الاثنين' },
  { day: 6,  dateStr: '24/02/2026', dayName: 'الثلاثاء' },
  { day: 7,  dateStr: '25/02/2026', dayName: 'الأربعاء' },
  { day: 8,  dateStr: '26/02/2026', dayName: 'الخميس' },
  { day: 9,  dateStr: '27/02/2026', dayName: 'الجمعة' },
  { day: 10, dateStr: '28/02/2026', dayName: 'السبت' },
  { day: 11, dateStr: '01/03/2026', dayName: 'الأحد' },
  { day: 12, dateStr: '02/03/2026', dayName: 'الاثنين' },
  { day: 13, dateStr: '03/03/2026', dayName: 'الثلاثاء' },
  { day: 14, dateStr: '04/03/2026', dayName: 'الأربعاء' },
  { day: 15, dateStr: '05/03/2026', dayName: 'الخميس' },
  { day: 16, dateStr: '06/03/2026', dayName: 'الجمعة' },
  { day: 17, dateStr: '07/03/2026', dayName: 'السبت' },
  { day: 18, dateStr: '08/03/2026', dayName: 'الأحد' },
  { day: 19, dateStr: '09/03/2026', dayName: 'الاثنين' },
  { day: 20, dateStr: '10/03/2026', dayName: 'الثلاثاء' },
  { day: 21, dateStr: '11/03/2026', dayName: 'الأربعاء' },
  { day: 22, dateStr: '12/03/2026', dayName: 'الخميس' },
  { day: 23, dateStr: '13/03/2026', dayName: 'الجمعة' },
  { day: 24, dateStr: '14/03/2026', dayName: 'السبت' },
  { day: 25, dateStr: '15/03/2026', dayName: 'الأحد' },
  { day: 26, dateStr: '16/03/2026', dayName: 'الاثنين' },
  { day: 27, dateStr: '17/03/2026', dayName: 'الثلاثاء' },
  { day: 28, dateStr: '18/03/2026', dayName: 'الأربعاء' },
  { day: 29, dateStr: '19/03/2026', dayName: 'الخميس' },
  { day: 30, dateStr: '20/03/2026', dayName: 'الجمعة' },
];

// ============================================================
// بيانات حقيقية مجلوبة مباشرة من ma.prayertimes.news
// كل صف = يوم رمضان (من 19 فبراير إلى 20 مارس)
// ============================================================

const CASABLANCA = [
  ['05:50','07:19','12:52','04:00','06:25','07:55'],
  ['05:49','07:17','12:52','04:00','06:26','07:56'],
  ['05:48','07:16','12:52','04:01','06:27','07:57'],
  ['05:47','07:15','12:51','04:02','06:28','07:58'],
  ['05:46','07:14','12:51','04:02','06:29','07:59'],
  ['05:45','07:13','12:51','04:03','06:29','07:59'],
  ['05:44','07:12','12:51','04:03','06:30','08:00'],
  ['05:43','07:11','12:51','04:04','06:31','08:01'],
  ['05:42','07:09','12:51','04:04','06:32','08:02'],
  ['05:41','07:08','12:51','04:05','06:33','08:03'],
  ['05:40','07:07','12:50','04:05','06:34','08:04'],
  ['05:38','07:06','12:50','04:06','06:34','08:04'],
  ['05:37','07:05','12:50','04:06','06:35','08:05'],
  ['05:36','07:03','12:50','04:07','06:36','08:06'],
  ['05:35','07:02','12:50','04:07','06:37','08:07'],
  ['05:33','07:01','12:49','04:08','06:38','08:08'],
  ['05:32','07:00','12:49','04:08','06:39','08:09'],
  ['05:31','06:58','12:49','04:08','06:39','08:09'],
  ['05:30','06:57','12:49','04:09','06:40','08:10'],
  ['05:28','06:56','12:48','04:09','06:41','08:11'],
  ['05:27','06:54','12:48','04:10','06:42','08:12'],
  ['05:26','06:53','12:48','04:10','06:43','08:13'],
  ['05:24','06:52','12:48','04:10','06:43','08:13'],
  ['05:23','06:51','12:47','04:11','06:44','08:14'],
  ['05:22','06:49','12:47','04:11','06:45','08:15'],
  ['05:20','06:48','12:47','04:11','06:46','08:16'],
  ['05:19','06:47','12:46','04:12','06:46','08:16'],
  ['05:17','06:45','12:46','04:12','06:47','08:17'],
  ['05:16','06:44','12:46','04:12','06:48','08:18'],
  ['05:15','06:43','12:45','04:13','06:49','08:19'],
];

const RABAT = [
  ['05:47','07:16','12:49','03:56','06:22','07:52'],
  ['05:46','07:15','12:49','03:57','06:22','07:52'],
  ['05:45','07:14','12:49','03:58','06:23','07:53'],
  ['05:44','07:13','12:48','03:58','06:24','07:54'],
  ['05:43','07:12','12:48','03:59','06:25','07:55'],
  ['05:42','07:10','12:48','03:59','06:26','07:56'],
  ['05:41','07:09','12:48','04:00','06:27','07:57'],
  ['05:40','07:08','12:48','04:01','06:28','07:58'],
  ['05:39','07:07','12:48','04:01','06:29','07:59'],
  ['05:38','07:06','12:48','04:02','06:30','08:00'],
  ['05:36','07:04','12:47','04:02','06:30','08:00'],
  ['05:35','07:03','12:47','04:03','06:31','08:01'],
  ['05:34','07:02','12:47','04:03','06:32','08:02'],
  ['05:33','07:01','12:47','04:04','06:33','08:03'],
  ['05:32','06:59','12:47','04:04','06:34','08:04'],
  ['05:30','06:58','12:46','04:04','06:35','08:05'],
  ['05:29','06:57','12:46','04:05','06:35','08:05'],
  ['05:28','06:56','12:46','04:05','06:36','08:06'],
  ['05:26','06:54','12:46','04:06','06:37','08:07'],
  ['05:25','06:53','12:45','04:06','06:38','08:08'],
  ['05:24','06:52','12:45','04:06','06:39','08:09'],
  ['05:22','06:50','12:45','04:07','06:39','08:09'],
  ['05:21','06:49','12:45','04:07','06:40','08:10'],
  ['05:20','06:48','12:44','04:08','06:41','08:11'],
  ['05:18','06:46','12:44','04:08','06:42','08:12'],
  ['05:17','06:45','12:44','04:08','06:43','08:13'],
  ['05:15','06:44','12:44','04:09','06:43','08:13'],
  ['05:14','06:42','12:43','04:09','06:44','08:14'],
  ['05:13','06:41','12:43','04:09','06:45','08:15'],
  ['05:11','06:40','12:43','04:10','06:46','08:16'],
];

const MARRAKECH = [
  ['05:52','07:18','12:53','04:04','06:29','07:59'],
  ['05:51','07:17','12:53','04:04','06:30','08:00'],
  ['05:50','07:16','12:53','04:05','06:30','08:00'],
  ['05:49','07:15','12:53','04:05','06:31','08:01'],
  ['05:48','07:14','12:53','04:06','06:32','08:02'],
  ['05:47','07:13','12:53','04:06','06:33','08:03'],
  ['05:46','07:12','12:53','04:07','06:34','08:04'],
  ['05:45','07:11','12:52','04:07','06:34','08:04'],
  ['05:44','07:09','12:52','04:08','06:35','08:05'],
  ['05:43','07:08','12:52','04:08','06:36','08:06'],
  ['05:42','07:07','12:52','04:08','06:37','08:07'],
  ['05:40','07:06','12:52','04:09','06:37','08:07'],
  ['05:39','07:05','12:52','04:09','06:38','08:08'],
  ['05:38','07:04','12:51','04:10','06:39','08:09'],
  ['05:37','07:03','12:51','04:10','06:40','08:10'],
  ['05:36','07:01','12:51','04:10','06:40','08:10'],
  ['05:35','07:00','12:51','04:11','06:41','08:11'],
  ['05:34','06:59','12:50','04:11','06:42','08:12'],
  ['05:32','06:58','12:50','04:11','06:43','08:13'],
  ['05:31','06:57','12:50','04:12','06:43','08:13'],
  ['05:30','06:55','12:50','04:12','06:44','08:14'],
  ['05:29','06:54','12:49','04:12','06:45','08:15'],
  ['05:27','06:53','12:49','04:12','06:45','08:15'],
  ['05:26','06:52','12:49','04:13','06:46','08:16'],
  ['05:25','06:50','12:49','04:13','06:47','08:17'],
  ['05:23','06:49','12:48','04:13','06:47','08:17'],
  ['05:22','06:48','12:48','04:13','06:48','08:18'],
  ['05:21','06:47','12:47','04:14','06:49','08:19'],
  ['05:19','06:45','12:47','04:14','06:50','08:20'],
  ['05:18','06:44','12:47','04:14','06:50','08:20'],
];

const FES = [
  ['05:40','07:09','12:41','03:49','06:14','07:44'],
  ['05:39','07:08','12:41','03:50','06:15','07:45'],
  ['05:38','07:06','12:41','03:50','06:16','07:46'],
  ['05:37','07:05','12:41','03:51','06:17','07:47'],
  ['05:36','07:04','12:41','03:51','06:18','07:48'],
  ['05:35','07:03','12:41','03:52','06:19','07:49'],
  ['05:34','07:02','12:41','03:53','06:19','07:49'],
  ['05:33','07:01','12:41','03:53','06:20','07:50'],
  ['05:31','07:00','12:40','03:54','06:21','07:51'],
  ['05:30','06:58','12:40','03:54','06:22','07:52'],
  ['05:29','06:57','12:40','03:55','06:23','07:53'],
  ['05:28','06:56','12:40','03:55','06:24','07:54'],
  ['05:27','06:55','12:40','03:56','06:25','07:55'],
  ['05:25','06:53','12:39','03:56','06:25','07:55'],
  ['05:24','06:52','12:39','03:57','06:26','07:56'],
  ['05:23','06:51','12:39','03:57','06:27','07:57'],
  ['05:22','06:50','12:39','03:57','06:28','07:58'],
  ['05:20','06:48','12:39','03:58','06:29','07:59'],
  ['05:19','06:47','12:38','03:58','06:30','08:00'],
  ['05:18','06:46','12:38','03:59','06:30','08:00'],
  ['05:16','06:44','12:38','03:59','06:31','08:01'],
  ['05:15','06:43','12:38','03:59','06:32','08:02'],
  ['05:14','06:42','12:37','04:00','06:33','08:03'],
  ['05:12','06:40','12:37','04:00','06:34','08:04'],
  ['05:11','06:39','12:37','04:00','06:34','08:04'],
  ['05:09','06:38','12:36','04:01','06:35','08:05'],
  ['05:08','06:36','12:36','04:01','06:36','08:06'],
  ['05:07','06:35','12:36','04:01','06:37','08:07'],
  ['05:05','06:34','12:36','04:02','06:38','08:08'],
  ['05:04','06:32','12:35','04:02','06:38','08:08'],
];

const AGADIR = [
  ['05:49','07:14','12:50','04:01','06:26','07:56'],
  ['05:48','07:13','12:50','04:02','06:27','07:57'],
  ['05:47','07:12','12:50','04:02','06:28','07:58'],
  ['05:46','07:11','12:50','04:03','06:29','07:59'],
  ['05:45','07:10','12:50','04:03','06:30','08:00'],
  ['05:44','07:09','12:50','04:04','06:30','08:00'],
  ['05:43','07:08','12:50','04:04','06:31','08:01'],
  ['05:42','07:07','12:49','04:05','06:32','08:02'],
  ['05:41','07:06','12:49','04:05','06:33','08:03'],
  ['05:40','07:05','12:49','04:05','06:33','08:03'],
  ['05:39','07:04','12:49','04:06','06:34','08:04'],
  ['05:38','07:03','12:49','04:06','06:35','08:05'],
  ['05:37','07:01','12:48','04:07','06:35','08:05'],
  ['05:35','07:00','12:48','04:07','06:36','08:06'],
  ['05:34','06:59','12:48','04:07','06:37','08:07'],
  ['05:33','06:58','12:48','04:08','06:38','08:08'],
  ['05:32','06:57','12:48','04:08','06:38','08:08'],
  ['05:31','06:56','12:47','04:08','06:39','08:09'],
  ['05:30','06:54','12:47','04:09','06:40','08:10'],
  ['05:28','06:53','12:47','04:09','06:40','08:10'],
  ['05:27','06:52','12:47','04:09','06:41','08:11'],
  ['05:26','06:51','12:46','04:09','06:42','08:12'],
  ['05:25','06:50','12:46','04:10','06:42','08:12'],
  ['05:23','06:48','12:46','04:10','06:43','08:13'],
  ['05:22','06:47','12:46','04:10','06:44','08:14'],
  ['05:21','06:46','12:45','04:10','06:44','08:14'],
  ['05:20','06:45','12:45','04:11','06:45','08:15'],
  ['05:18','06:44','12:45','04:11','06:46','08:16'],
  ['05:17','06:42','12:44','04:11','06:46','08:16'],
  ['05:16','06:41','12:44','04:11','06:47','08:17'],
];

const TANGER = [
  ['05:44','07:14','12:45','03:50','06:15','07:45'],
  ['05:42','07:13','12:45','03:51','06:16','07:46'],
  ['05:41','07:12','12:45','03:51','06:17','07:47'],
  ['05:40','07:10','12:44','03:52','06:18','07:48'],
  ['05:39','07:09','12:44','03:53','06:19','07:49'],
  ['05:38','07:08','12:44','03:53','06:20','07:50'],
  ['05:37','07:07','12:44','03:54','06:21','07:51'],
  ['05:36','07:06','12:44','03:55','06:22','07:52'],
  ['05:34','07:04','12:44','03:55','06:23','07:53'],
  ['05:33','07:03','12:44','03:56','06:24','07:54'],
  ['05:32','07:02','12:43','03:56','06:25','07:55'],
  ['05:31','07:00','12:43','03:57','06:26','07:56'],
  ['05:29','06:59','12:43','03:58','06:27','07:57'],
  ['05:28','06:58','12:43','03:58','06:28','07:58'],
  ['05:27','06:56','12:43','03:59','06:29','07:59'],
  ['05:25','06:55','12:42','03:59','06:29','07:59'],
  ['05:24','06:54','12:42','04:00','06:30','08:00'],
  ['05:23','06:52','12:42','04:00','06:31','08:01'],
  ['05:21','06:51','12:42','04:01','06:32','08:02'],
  ['05:20','06:50','12:41','04:01','06:33','08:03'],
  ['05:18','06:48','12:41','04:01','06:34','08:04'],
  ['05:17','06:47','12:41','04:02','06:35','08:05'],
  ['05:15','06:45','12:41','04:02','06:36','08:06'],
  ['05:14','06:44','12:40','04:03','06:37','08:07'],
  ['05:13','06:43','12:40','04:03','06:37','08:07'],
  ['05:11','06:41','12:40','04:04','06:38','08:08'],
  ['05:10','06:40','12:39','04:04','06:39','08:09'],
  ['05:08','06:38','12:39','04:04','06:40','08:10'],
  ['05:07','06:37','12:39','04:04','06:41','08:11'],
  ['05:05','06:36','12:39','04:05','06:41','08:11'],
];

const OUJDA = [
  ['05:28','06:57','12:29','03:36','06:01','07:31'],
  ['05:27','06:56','12:29','03:36','06:02','07:32'],
  ['05:26','06:55','12:29','03:37','06:03','07:33'],
  ['05:25','06:54','12:29','03:38','06:04','07:34'],
  ['05:23','06:52','12:29','03:38','06:05','07:35'],
  ['05:22','06:51','12:28','03:39','06:06','07:36'],
  ['05:21','06:50','12:28','03:39','06:06','07:36'],
  ['05:20','06:49','12:28','03:40','06:07','07:37'],
  ['05:19','06:48','12:28','03:41','06:08','07:38'],
  ['05:18','06:46','12:28','03:41','06:09','07:39'],
  ['05:16','06:45','12:28','03:42','06:10','07:40'],
  ['05:15','06:44','12:27','03:42','06:11','07:41'],
  ['05:14','06:43','12:27','03:43','06:12','07:42'],
  ['05:13','06:41','12:27','03:43','06:13','07:43'],
  ['05:11','06:40','12:27','03:44','06:13','07:43'],
  ['05:10','06:39','12:27','03:44','06:14','07:44'],
  ['05:09','06:37','12:26','03:45','06:15','07:45'],
  ['05:08','06:36','12:26','03:45','06:16','07:46'],
  ['05:06','06:35','12:26','03:45','06:17','07:47'],
  ['05:05','06:33','12:26','03:46','06:18','07:48'],
  ['05:03','06:32','12:25','03:46','06:19','07:49'],
  ['05:02','06:31','12:25','03:47','06:19','07:49'],
  ['05:01','06:29','12:25','03:47','06:20','07:50'],
  ['04:59','06:28','12:25','03:47','06:21','07:51'],
  ['04:58','06:27','12:24','03:48','06:22','07:52'],
  ['04:56','06:25','12:24','03:48','06:23','07:53'],
  ['04:55','06:24','12:24','03:49','06:23','07:53'],
  ['04:54','06:23','12:23','03:49','06:24','07:54'],
  ['04:52','06:21','12:23','03:49','06:25','07:55'],
  ['04:51','06:20','12:23','03:50','06:26','07:56'],
];

// ============================================================
// جدول إسناد المدن لأقرب مدينة عندها بيانات حقيقية
// ============================================================
const CITY_DATA = {
  casablanca: CASABLANCA,
  rabat: RABAT,
  marrakech: MARRAKECH,
  fes: FES,
  agadir: AGADIR,
  tanger: TANGER,
  oujda: OUJDA,
  // مدن قريبة — نستعمل بياناتها المرجعية + تعديل طفيف
  sale: RABAT,           // سلا ≈ الرباط (بجانبها)
  kenitra: RABAT,        // القنيطرة ≈ الرباط
  temara: RABAT,         // تمارة ≈ الرباط
  khemisset: RABAT,      // الخميسات ≈ الرباط
  meknes: FES,           // مكناس ≈ فاس
  taza: FES,             // تازة ≈ فاس
  ifrane: FES,           // إفران ≈ فاس
  azrou: FES,            // أزرو ≈ فاس
  sefrou: FES,           // صفرو ≈ فاس
  beni_mellal: MARRAKECH,// بني ملال ≈ مراكش
  khouribga: CASABLANCA, // خريبكة ≈ الدار البيضاء
  settat: CASABLANCA,    // سطات ≈ الدار البيضاء
  el_jadida: CASABLANCA, // الجديدة ≈ الدار البيضاء
  safi: CASABLANCA,      // آسفي ≈ الدار البيضاء
  essaouira: AGADIR,     // الصويرة ≈ أكادير
  tiznit: AGADIR,        // تيزنيت ≈ أكادير
  taroudant: AGADIR,     // تارودانت ≈ أكادير
  inzegan: AGADIR,       // إنزكان ≈ أكادير
  benguerir: MARRAKECH,  // بن جرير ≈ مراكش
  kalaat_sraghna: MARRAKECH,
  youssoufia: CASABLANCA,
  tetouan: TANGER,       // تطوان ≈ طنجة
  chefchaouen: TANGER,   // شفشاون ≈ طنجة
  larache: TANGER,       // العرائش ≈ طنجة
  ksar_el_kebir: TANGER, // القصر الكبير ≈ طنجة
  al_hoceima: TANGER,    // الحسيمة ≈ طنجة
  nador: OUJDA,          // الناظور ≈ وجدة
  berkane: OUJDA,        // بركان ≈ وجدة
  taourirt: OUJDA,       // تاوريرت ≈ وجدة
  ouarzazate: MARRAKECH, // ورزازات ≈ مراكش
  errachidia: FES,       // الراشيدية ≈ فاس
  midelt: FES,           // ميدلت ≈ فاس
  azilal: MARRAKECH,     // أزيلال ≈ مراكش
  zagora: MARRAKECH,     // زاكورة ≈ مراكش
  guelmim: AGADIR,       // كلميم ≈ أكادير
  tan_tan: AGADIR,       // طانطان ≈ أكادير
  laayoune: AGADIR,      // العيون ≈ أكادير (تقريبي)
  dakhla: AGADIR,        // الداخلة ≈ أكادير (تقريبي)
};

// ============================================================
// تعديل الوقت بفرق خط الطول بين المدينة ومرجعها
// ============================================================
const REFERENCE_LONS = {
  casablanca: -7.5898, rabat: -6.8416, marrakech: -7.9811,
  fes: -5.0000, agadir: -9.5981, tanger: -5.8340, oujda: -1.9086,
};

function getRefCity(cityId) {
  const refMap = {
    sale: 'rabat', kenitra: 'rabat', temara: 'rabat', khemisset: 'rabat',
    meknes: 'fes', taza: 'fes', ifrane: 'fes', azrou: 'fes', sefrou: 'fes',
    beni_mellal: 'marrakech', khouribga: 'casablanca', settat: 'casablanca',
    el_jadida: 'casablanca', safi: 'casablanca', essaouira: 'agadir',
    tiznit: 'agadir', taroudant: 'agadir', inzegan: 'agadir',
    benguerir: 'marrakech', kalaat_sraghna: 'marrakech', youssoufia: 'casablanca',
    tetouan: 'tanger', chefchaouen: 'tanger', larache: 'tanger',
    ksar_el_kebir: 'tanger', al_hoceima: 'tanger', nador: 'oujda',
    berkane: 'oujda', taourirt: 'oujda', ouarzazate: 'marrakech',
    errachidia: 'fes', midelt: 'fes', azilal: 'marrakech', zagora: 'marrakech',
    guelmim: 'agadir', tan_tan: 'agadir', laayoune: 'agadir', dakhla: 'agadir',
    azrou: 'fes',
  };
  return refMap[cityId] || 'casablanca';
}

function adjustTime(t, deltaMin) {
  const [h, m] = t.split(':').map(Number);
  const total = ((h * 60 + m + deltaMin) % 1440 + 1440) % 1440;
  return `${String(Math.floor(total / 60)).padStart(2,'0')}:${String(total % 60).padStart(2,'0')}`;
}

export function getTimesForCity(city) {
  const cityId = city.id;
  const rawData = CITY_DATA[cityId] || CASABLANCA;
  
  // حساب تعديل خط الطول
  const refId = REFERENCE_LONS[cityId] ? cityId : getRefCity(cityId);
  const refLon = REFERENCE_LONS[refId] || REFERENCE_LONS['casablanca'];
  const deltaMin = Math.round((city.lon - refLon) * 4);

  return RAMADAN_DAYS.map((d, i) => {
    const row = rawData[i] || rawData[rawData.length - 1];
    const [fajr, shuruq, dhuhr, asr, maghrib, isha] = row.map(t =>
      deltaMin !== 0 ? adjustTime(t, deltaMin) : t
    );
    const [day, month, year] = d.dateStr.split('/').map(Number);
    return {
      day: d.day,
      dateStr: d.dateStr,
      dayName: d.dayName,
      date: new Date(year, month - 1, day),
      fajr, shuruq, dhuhr, asr, maghrib, isha,
    };
  });
}